<%- include('../partials/head') %>
</head>

<body class="bg-gray-50 min-h-screen font-sans">
  <%- include('../partials/nav') %>
  <%- include('../partials/toast') %>
  <%- include('../partials/animation') %>

  <div class="max-w-3xl mx-auto bg-white shadow-xl rounded-2xl border border-gray-200 p-8 mt-10">
    <h1 class="text-3xl font-extrabold mb-6 text-center text-purple-700">
      Mark Attendance 
      <!-- <%= IsLoggedIn ? ' (Logged In)' : ' (Logged Out)' %> -->
    </h1>

    <!-- Attendance Filter Form -->
    <form action="/showList" method="POST" class="flex flex-col gap-6 mb-6">
      <!-- Class Selection -->
      <div>
        <p class="font-semibold mb-2 text-gray-700">Select Branch Name:</p>
        <label class="flex items-center gap-2 mb-2">
          <input type="radio" name="className" value="CSE" <%= selectedClass === 'CSE' ? 'checked' : '' %> class="accent-purple-600" />
          CSE
        </label>
      </div>

      <!-- Section Selection -->
        <div class="flex-1">
        <p class="font-semibold mb-2 text-gray-700">Select Section Name:</p>
        <div class="flex gap-6">
          <label class="flex items-center gap-2">
            <input type="radio" name="sectionName" value="A" <%= selectedSection === 'A' ? 'checked' : '' %> class="accent-pink-500" /> A
          </label>
          <label class="flex items-center gap-2">
            <input type="radio" name="sectionName" value="B" <%= selectedSection === 'B' ? 'checked' : '' %> class="accent-pink-500" /> B
          </label>
          <label class="flex items-center gap-2">
            <input type="radio" name="sectionName" value="C" <%= selectedSection === 'C' ? 'checked' : '' %> class="accent-pink-500" /> C
          </label>
        </div>
      </div>

      <!-- Year Selection -->
       <div class="flex-1">
        <p class="font-semibold mb-2 text-gray-700">Select Year:</p>
        <div class="flex gap-6">
          <label class="flex items-center gap-2">
            <input type="radio" name="year" value="I" <%= selectedYear === 'I' ? 'checked' : '' %> class="accent-indigo-600" /> I
          </label>
          <label class="flex items-center gap-2">
            <input type="radio" name="year" value="II" <%= selectedYear === 'II' ? 'checked' : '' %> class="accent-indigo-600" /> II
          </label>
          <label class="flex items-center gap-2">
            <input type="radio" name="year" value="III" <%= selectedYear === 'III' ? 'checked' : '' %> class="accent-indigo-600" /> III
          </label>
          <label class="flex items-center gap-2">
            <input type="radio" name="year" value="IV" <%= selectedYear === 'IV' ? 'checked' : '' %> class="accent-indigo-600" /> IV
          </label>
        </div>
      </div>

      <!-- Subject Selection -->
      <div>
        <label class="block font-semibold mb-1">Subject</label>
        <select name="subject" required class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-400 mb-4">
          <option value="" disabled selected>Select subject</option>
          <option value="Maths" <%= selectedSubject === 'Maths' ? 'selected' : '' %>>Maths</option>
          <option value="Physics" <%= selectedSubject === 'Physics' ? 'selected' : '' %>>Physics</option>
          <option value="DSA" <%= selectedSubject === 'DSA' ? 'selected' : '' %>>DSA</option>
          <option value="DBMS" <%= selectedSubject === 'DBMS' ? 'selected' : '' %>>DBMS</option>
        </select>
      </div>

      <!-- Date Auto-filled -->
      <div>
        <label class="block font-semibold mb-1">Date</label>
        <input type="date" name="date" value="<%= new Date().toISOString().split('T')[0] %>" readonly
               class="w-full p-2 border border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed mb-4">
      </div>

      <!-- Submit Button -->
      <button type="submit" class="w-full bg-blue-500 text-white py-3 rounded-xl font-bold shadow hover:bg-white hover:text-blue-500 border transition-all duration-200">
        View Students
      </button>
    </form>

    <!-- Student List (after filter) -->
    <% if (students && students.length > 0) { %>
      <form action="/submit-attendance" method="POST" class="flex flex-col gap-4">
        <input type="hidden" name="className" value="<%= selectedClass %>">
        <input type="hidden" name="sectionName" value="<%= selectedSection %>">
        <input type="hidden" name="year" value="<%= selectedYear %>">
        <input type="hidden" name="subject" value="<%= selectedSubject %>">
        <input type="hidden" name="date" value="<%= selectedDate %>">

        <div class="overflow-x-auto rounded-xl shadow-lg border border-gray-200">
          <table class="min-w-full table-auto border-collapse">
            <thead class="bg-gradient-to-r from-purple-500 to-pink-500 text-white text-lg font-bold">
              <tr>
                <th class="px-4 py-2">S.No</th>
                <th class="px-4 py-2">Name</th>
                <th class="px-4 py-2">Enrollment No</th>
                <th class="px-4 py-2">Attendance</th>
              </tr>
            </thead>
            <tbody>
              <% students.forEach((student, index) => { %>
                <tr class="hover:bg-purple-50 transition-all">
                  <td class="border px-4 py-2 text-center"><%= index + 1 %></td>
                  <td class="border px-4 py-2"><%= student.name %></td>
                  <td class="border px-4 py-2"><%= student.enrollmentNo %></td>
                  <td class="border px-4 py-2 text-center flex flex-col gap-2">
                    <label class="inline-flex items-center gap-1">
                      <input type="radio" name="attendance[<%= student.enrollmentNo %>]" value="Present" required class="accent-green-600" />
                      Present
                    </label>
                    <label class="inline-flex items-center gap-1">
                      <input type="radio" name="attendance[<%= student.enrollmentNo %>]" value="Absent" required class="accent-red-600" />
                      Absent
                    </label>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-col gap-3 mt-4">
          <button type="submit" class="bg-blue-500 text-white px-6 py-2 rounded-xl shadow hover:bg-white hover:text-blue-500 border transition-all duration-200">
            Submit Attendance
          </button>

          <button type="button" onclick="selectAllPresent()" class="bg-blue-500 text-white px-6 py-2 rounded-xl shadow hover:bg-white hover:text-blue-500 border transition-all duration-200">
            Select All Present
          </button>

          <button type="button" onclick="selectAllAbsent()" class="bg-blue-500 text-white px-6 py-2 rounded-xl shadow hover:bg-white hover:text-blue-500 border transition-all duration-200">
            Select All Absent
          </button>
        </div>
      </form>

      <script>
        function selectAllPresent() {
          document.querySelectorAll('input[type="radio"][value="Present"]').forEach(radio => radio.checked = true);
        }
        function selectAllAbsent() {
          document.querySelectorAll('input[type="radio"][value="Absent"]').forEach(radio => radio.checked = true);
        }
      </script>
    <% } else if (selectedClass && selectedSection) { %>
      <p class="text-center text-gray-500 mt-6">No students found for <strong><%= selectedClass %>-<%= selectedSection %></strong>.</p>
    <% } %>
  </div>
</body>
</html>
